import streamlit as st
import fitz  # PyMuPDF
from PIL import Image
import io

st.set_page_config(page_title="Stock Market & Mutual Fund - Official", layout="wide")

# ‡¥™‡µç‡¥∞‡µÄ‡¥Æ‡¥ø‡¥Ø‡¥Ç ‡¥¨‡µç‡¥≤‡¥æ‡¥ï‡µç‡¥ï‡µç & ‡¥ó‡µã‡µæ‡¥°‡µç ‡¥§‡µÄ‡¥Ç
st.markdown("""
    <style>
    .main { background-color: #f8f9fa; }
    .stSidebar { background-color: #0d1b2a; border-right: 3px solid #f1c40f; }
    .stSelectbox label { color: #f1c40f !important; font-size: 18px; font-weight: bold; }
    </style>
    """, unsafe_allow_html=True)

@st.cache_resource
def load_pdf(path):
    return fitz.open(path)

def main():
    pdf_path = "Stock_Market_&_Mutual_Fund_E_Book .pdf"
    
    try:
        doc = load_pdf(pdf_path)
        total_pages = len(doc)

        st.sidebar.title("üìñ ‡¥â‡¥≥‡µç‡¥≥‡¥ü‡¥ï‡µç‡¥ï‡¥Ç (53 Topics)")
        
        # PDF ‡¥µ‡¥∞‡¥ø‡¥µ‡¥∞‡¥ø‡¥Ø‡¥æ‡¥Ø‡¥ø ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ö‡µç‡¥ö ‡¥∂‡µá‡¥∑‡¥Ç ‡¥§‡¥Ø‡µç‡¥Ø‡¥æ‡¥±‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥Ø 100% ‡¥ï‡µÉ‡¥§‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥á‡µª‡¥°‡µÜ‡¥ï‡µç‡¥∏‡µç
        chapters = {
            "01. Cover Page": 1,
            "02. Blank Page": 2,
            "03. Title Page": 3,
            "04. ‡¥∏‡¥Æ‡µº‡¥™‡µç‡¥™‡¥£‡¥Ç": 4,
            "05. ‡¥é‡¥®‡µç‡¥®‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µç..": 5,
            "06. ‡¥®‡¥®‡µç‡¥¶‡¥ø": 9,
            "07. ‡¥Ü‡¥Æ‡µÅ‡¥ñ‡¥Ç": 11,
            "08. ‡¥Ö‡¥±‡¥ø‡¥µ‡µÅ‡¥Ç ‡¥Æ‡µÅ‡¥®‡µç‡¥®‡µä‡¥∞‡µÅ‡¥ï‡µç‡¥ï‡¥µ‡µÅ‡¥Ç": 13,
            "09. ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç ‡¥™‡¥£‡¥Ç?": 14,
            "10. ‡¥™‡¥£‡¥™‡µç‡¥™‡µÜ‡¥∞‡µÅ‡¥™‡µç‡¥™‡¥Ç (Inflation)": 15,
            "11. ‡¥∏‡¥Æ‡µç‡¥™‡¥æ‡¥¶‡µç‡¥Ø‡¥µ‡µÅ‡¥Ç ‡¥®‡¥ø‡¥ï‡µç‡¥∑‡µá‡¥™‡¥µ‡µÅ‡¥Ç": 16,
            "12. ‡¥®‡¥ø‡¥ï‡µç‡¥∑‡µá‡¥™‡¥Ç ‡¥é‡¥µ‡¥ø‡¥ü‡µÜ ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡¥£‡¥Ç?": 17,
            "13. ‡¥ì‡¥π‡¥∞‡¥ø ‡¥µ‡¥ø‡¥™‡¥£‡¥ø‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥π‡µÉ‡¥¶‡¥Ø‡¥§‡µç‡¥§‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç": 19,
            "14. ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç ‡¥∑‡µÜ‡¥Ø‡µº ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç?": 20,
            "15. ‡¥ï‡µã‡¥Æ‡µç‡¥™‡µó‡¥£‡µç‡¥ü‡¥ø‡¥Ç‡¥ó‡µç (Compounding)": 21,
            "16. PE Ratio (Price to Earnings)": 22,
            "17. Dividend Yield": 23,
            "18. ‡¥ì‡¥π‡¥∞‡¥ø ‡¥µ‡¥ø‡¥™‡¥£‡¥ø‡¥Ø‡¥ø‡¥≤‡µÜ ‡¥±‡¥ø‡¥∏‡µç‡¥ï‡µç": 24,
            "19. ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥ï‡µç‡¥Ø‡¥æ‡¥™‡¥ø‡¥±‡µç‡¥±‡¥≤‡µà‡¥∏‡µá‡¥∑‡µª": 25,
            "20. ‡¥≤‡¥æ‡µº‡¥ú‡µç, ‡¥Æ‡¥ø‡¥°‡µç, ‡¥∏‡µç‡¥Æ‡µã‡µæ ‡¥ï‡µç‡¥Ø‡¥æ‡¥™‡µç": 26,
            "21. NSE & BSE ‡¥é‡¥ï‡µç‡¥∏‡µç‡¥ö‡µá‡¥û‡µç‡¥ö‡µÅ‡¥ï‡µæ": 27,
            "22. ‡¥∏‡µÜ‡¥¨‡¥ø (SEBI)": 29,
            "23. ‡¥á‡µª‡¥°‡¥ï‡µç‡¥∏‡µç (Nifty & Sensex)": 30,
            "24. ‡¥™‡µç‡¥∞‡µà‡¥Æ‡¥±‡¥ø ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç": 32,
            "25. ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡¥±‡¥ø ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç": 32,
            "26. ‡¥°‡¥ø‡¥µ‡¥ø‡¥°‡µª‡¥°‡µç (Dividend)": 33,
            "27. ‡¥°‡¥ø‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µç ‡¥Ö‡¥ï‡µç‡¥ï‡µó‡¥£‡µç‡¥ü‡µç": 34,
            "28. ‡¥ü‡µç‡¥∞‡µá‡¥°‡¥ø‡¥Ç‡¥ó‡µÅ‡¥Ç ‡¥á‡µª‡¥µ‡µÜ‡¥∏‡µç‡¥±‡µç‡¥±‡¥ø‡¥Ç‡¥ó‡µÅ‡¥Ç": 35,
            "29. ‡¥á‡µª‡¥ü‡µç‡¥∞‡¥æ‡¥°‡µá ‡¥ü‡µç‡¥∞‡µá‡¥°‡¥ø‡¥Ç‡¥ó‡µç": 36,
            "30. ‡¥°‡µÜ‡¥≤‡¥ø‡¥µ‡¥±‡¥ø ‡¥ü‡µç‡¥∞‡µá‡¥°‡¥ø‡¥Ç‡¥ó‡µç": 36,
            "31. ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç IPO?": 37,
            "32. IPO ‡¥Ö‡¥™‡µç‡¥≤‡µà ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥® ‡¥∞‡µÄ‡¥§‡¥ø": 39,
            "33. ‡¥´‡¥£‡µç‡¥ü‡¥Æ‡µÜ‡¥®‡µç‡¥±‡µΩ ‡¥Ö‡¥®‡¥æ‡¥≤‡¥ø‡¥∏‡¥ø‡¥∏‡µç": 40,
            "34. ‡¥¨‡¥æ‡¥≤‡µª‡¥∏‡µç ‡¥∑‡µÄ‡¥±‡µç‡¥±‡µç": 41,
            "35. Asset Turnover Ratio": 41,
            "36. Current Ratio": 41,
            "37. ‡¥≤‡¥æ‡¥≠‡¥®‡¥∑‡µç‡¥ü ‡¥ï‡¥£‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡µæ (P&L)": 42,
            "38. Debt to Equity Ratio": 42,
            "39. ROE & ROCE": 43,
            "40. ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç ‡¥Æ‡µç‡¥Ø‡µÇ‡¥ö‡µç‡¥ö‡µΩ‡¥´‡¥£‡µç‡¥ü‡µç?": 44,
            "41. ‡¥Æ‡µç‡¥Ø‡µÇ‡¥ö‡µç‡¥ö‡µΩ‡¥´‡¥£‡µç‡¥ü‡µç ‡¥§‡¥∞‡¥ô‡µç‡¥ô‡µæ": 45,
            "42. ‡¥°‡¥Ø‡¥±‡¥ï‡µç‡¥ü‡µç vs ‡¥±‡µÜ‡¥ó‡µÅ‡¥≤‡µº ‡¥´‡¥£‡µç‡¥ü‡µç": 47,
            "43. ‡¥Æ‡µç‡¥Ø‡µÇ‡¥ö‡µç‡¥ö‡µΩ‡¥´‡¥£‡µç‡¥ü‡µç ‡¥Ö‡¥®‡¥æ‡¥≤‡¥ø‡¥∏‡¥ø‡¥∏‡µç": 48,
            "44. ‡¥é‡¥ï‡µç‡¥∏‡µç‡¥™‡µÜ‡µª‡¥∏‡µç ‡¥±‡µá‡¥∑‡µç‡¥Ø‡µã": 49,
            "45. Sharpe Ratio": 49,
            "46. Standard Deviation": 49,
            "47. ‡¥é‡¥ï‡µç‡¥∏‡¥ø‡¥±‡µç‡¥±‡µç ‡¥≤‡µã‡¥°‡µç": 50,
            "48. ‡¥¨‡µÄ‡¥±‡µç‡¥± (Beta)": 50,
            "49. ‡¥®‡¥∑‡µç‡¥ü‡¥ï‡µç‡¥ï‡¥£‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡µæ ‡¥§‡¥ø‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡¥±‡¥ø‡¥Ø‡¥æ‡¥Ç": 51,
            "50. ‡¥ï‡¥ü‡¥ï‡µç‡¥ï‡µÜ‡¥£‡¥ø‡¥ï‡µæ": 52,
            "51. ‡¥ï‡µç‡¥∞‡µÜ‡¥°‡¥ø‡¥±‡µç‡¥±‡µç ‡¥ï‡¥æ‡µº‡¥°‡µç ‡¥ö‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥¥‡¥ø‡¥ï‡µæ": 54,
            "52. ‡¥ì‡¥π‡¥∞‡¥ø ‡¥µ‡¥ø‡¥™‡¥£‡¥ø‡¥Ø‡¥ø‡¥≤‡µÜ ‡¥ö‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥¥‡¥ø‡¥ï‡µæ": 55,
            "53. ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥§‡µç‡¥§‡¥ø‡¥ï ‡¥Ö‡¥ö‡µç‡¥ö‡¥ü‡¥ï‡µç‡¥ï‡¥Ç": 59,
            "54. ‡¥é‡¥Æ‡µº‡¥ú‡µª‡¥∏‡¥ø ‡¥´‡¥£‡µç‡¥ü‡µç": 60,
            "55. ‡¥Ø‡¥•‡¥æ‡µº‡¥§‡µç‡¥• ‡¥∏‡¥Æ‡µç‡¥™‡¥æ‡¥¶‡µç‡¥Ø‡¥Ç": 61,
            "56. ‡¥Ü‡¥∞‡µã‡¥ó‡µç‡¥Ø ‡¥á‡µª‡¥∑‡µÅ‡¥±‡µª‡¥∏‡µç": 62,
            "57. ‡¥ü‡µá‡¥Ç ‡¥á‡µª‡¥∑‡µÅ‡¥±‡µª‡¥∏‡µç": 63,
            "58. ‡¥â‡¥™‡¥∏‡¥Ç‡¥π‡¥æ‡¥∞‡¥Ç": 65,
            "59. Bibliography": 67
        }

        selected = st.sidebar.selectbox("‡¥Ö‡¥ß‡µç‡¥Ø‡¥æ‡¥Ø‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï:", list(chapters.keys()))
        target_page = chapters[selected]

        st.sidebar.markdown("---")
        # ‡¥Ø‡µÇ‡¥∏‡µº‡¥ï‡µç‡¥ï‡µç ‡¥®‡µá‡¥∞‡¥ø‡¥ü‡µç‡¥ü‡µç ‡¥™‡µá‡¥ú‡µç ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥æ‡¥®‡µÅ‡¥Ç ‡¥∏‡µó‡¥ï‡¥∞‡µç‡¥Ø‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
        page_num = st.sidebar.number_input("‡¥™‡µá‡¥ú‡µç ‡¥®‡¥Æ‡µç‡¥™‡µº:", min_value=1, max_value=total_pages, value=target_page)

        st.title("üìà Stock Market & Mutual Fund")
        st.subheader(f"‡¥µ‡¥ø‡¥≠‡¥æ‡¥ó‡¥Ç: {selected}")

        # PDF Rendering
        page = doc.load_page(page_num - 1)
        pix = page.get_pixmap(matrix=fitz.Matrix(2.2, 2.2)) # ‡¥ï‡µç‡¥µ‡¥æ‡¥≥‡¥ø‡¥±‡µç‡¥±‡¥ø ‡¥Ö‡¥≤‡µç‡¥™‡¥Ç ‡¥ï‡µÇ‡¥ü‡¥ø ‡¥ï‡µÇ‡¥ü‡µç‡¥ü‡¥ø
        img = Image.open(io.BytesIO(pix.tobytes("png")))

        st.image(img, use_container_width=True)
        
        st.markdown(f"<p style='text-align: center; color: gray;'>Page {page_num} of {total_pages}</p>", unsafe_allow_html=True)

    except Exception as e:
        st.error(f"Error: {pdf_path} ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡µª ‡¥ï‡¥¥‡¥ø‡¥û‡µç‡¥û‡¥ø‡¥≤‡µç‡¥≤.")

if __name__ == "__main__":
    main()