import streamlit as st
import fitz  # PyMuPDF
from PIL import Image
import io

# ‡¥™‡µá‡¥ú‡µç ‡¥ï‡µã‡µ∫‡¥´‡¥ø‡¥ó‡¥±‡µá‡¥∑‡µª
st.set_page_config(page_title="Stock Market & Mutual Fund E-Book", layout="wide")

# ‡¥™‡µç‡¥∞‡µÄ‡¥Æ‡¥ø‡¥Ø‡¥Ç ‡¥≤‡µÅ‡¥ï‡µç‡¥ï‡¥ø‡¥®‡¥æ‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥°‡¥ø‡¥∏‡µà‡µª
st.markdown("""
    <style>
    .main { background-color: #f8f9fa; }
    .stSidebar { background-color: #011627; border-right: 3px solid #f1c40f; }
    .stSelectbox label { color: #f1c40f !important; font-size: 18px; font-weight: bold; }
    .stNumberInput label { color: white !important; }
    </style>
    """, unsafe_allow_html=True)

@st.cache_resource
def load_pdf(path):
    return fitz.open(path)

def main():
    pdf_path = "Stock_Market_&_Mutual_Fund_E_Book .pdf"
    
    try:
        doc = load_pdf(pdf_path)
        total_pages = len(doc)

        st.sidebar.title("üìë ‡¥∏‡¥Æ‡µç‡¥™‡µÇ‡µº‡¥£‡µç‡¥£ ‡¥â‡¥≥‡µç‡¥≥‡¥ü‡¥ï‡µç‡¥ï‡¥Ç")
        
        # PDF ‡¥µ‡¥∞‡¥ø‡¥µ‡¥∞‡¥ø‡¥Ø‡¥æ‡¥Ø‡¥ø ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥§‡¥Ø‡µç‡¥Ø‡¥æ‡¥±‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥Ø 100% ‡¥ï‡µÉ‡¥§‡µç‡¥Ø‡¥Æ‡¥æ‡¥Ø ‡¥á‡µª‡¥°‡¥ï‡µç‡¥∏‡µç
        chapters = {
            "01. Cover Page": 1,
            "02. Title Page": 3,
            "03. ‡¥∏‡¥Æ‡µº‡¥™‡µç‡¥™‡¥£‡¥Ç": 4,
            "04. ‡¥é‡¥®‡µç‡¥®‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥±‡¥ø‡¥ö‡µç‡¥ö‡µç..": 5,
            "05. ‡¥®‡¥®‡µç‡¥¶‡¥ø": 9,
            "06. ‡¥Ü‡¥Æ‡µÅ‡¥ñ‡¥Ç": 11,
            "07. ‡¥Ö‡¥±‡¥ø‡¥µ‡µÅ‡¥Ç ‡¥Æ‡µÅ‡¥®‡µç‡¥®‡µä‡¥∞‡µÅ‡¥ï‡µç‡¥ï‡¥µ‡µÅ‡¥Ç": 13,
            "08. ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç ‡¥™‡¥£‡¥Ç?": 14,
            "09. ‡¥™‡¥£‡¥™‡µç‡¥™‡µÜ‡¥∞‡µÅ‡¥™‡µç‡¥™‡¥Ç (Inflation)": 15,
            "10. ‡¥∏‡¥Æ‡µç‡¥™‡¥æ‡¥¶‡µç‡¥Ø‡¥µ‡µÅ‡¥Ç ‡¥®‡¥ø‡¥ï‡µç‡¥∑‡µá‡¥™‡¥µ‡µÅ‡¥Ç": 16,
            "11. ‡¥®‡¥ø‡¥ï‡µç‡¥∑‡µá‡¥™‡¥Ç ‡¥é‡¥µ‡¥ø‡¥ü‡µÜ ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡¥£‡¥Ç?": 17,
            "12. ‡¥ì‡¥π‡¥∞‡¥ø ‡¥µ‡¥ø‡¥™‡¥£‡¥ø‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥π‡µÉ‡¥¶‡¥Ø‡¥§‡µç‡¥§‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç": 19,
            "13. ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç ‡¥∑‡µÜ‡¥Ø‡µº ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç?": 20,
            "14. ‡¥ï‡µã‡¥Æ‡µç‡¥™‡µó‡¥£‡µç‡¥ü‡¥ø‡¥Ç‡¥ó‡µç (Compounding)": 21,
            "15. PE Ratio": 22,
            "16. Dividend Yield": 23,
            "17. ‡¥ì‡¥π‡¥∞‡¥ø ‡¥µ‡¥ø‡¥™‡¥£‡¥ø‡¥Ø‡¥ø‡¥≤‡µÜ ‡¥±‡¥ø‡¥∏‡µç‡¥ï‡µç": 24,
            "18. ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥ï‡µç‡¥Ø‡¥æ‡¥™‡¥ø‡¥±‡µç‡¥±‡¥≤‡µà‡¥∏‡µá‡¥∑‡µª": 25,
            "19. ‡¥≤‡¥æ‡µº‡¥ú‡µç, ‡¥Æ‡¥ø‡¥°‡µç, ‡¥∏‡µç‡¥Æ‡µã‡µæ ‡¥ï‡µç‡¥Ø‡¥æ‡¥™‡µç": 26,
            "20. ‡¥∏‡µç‡¥±‡µç‡¥±‡µã‡¥ï‡µç‡¥ï‡µç ‡¥é‡¥ï‡µç‡¥∏‡µç‡¥ö‡µá‡¥û‡µç‡¥ö‡µÅ‡¥ï‡µæ (NSE & BSE)": 27,
            "21. ‡¥∏‡µÜ‡¥¨‡¥ø (SEBI)": 29,
            "22. ‡¥á‡µª‡¥°‡¥ï‡µç‡¥∏‡µç (Nifty & Sensex)": 30,
            "23. ‡¥¨‡µÅ‡µæ & ‡¥¨‡¥ø‡¥Ø‡µº ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç": 31,
            "24. ‡¥™‡µç‡¥∞‡µà‡¥Æ‡¥±‡¥ø ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç": 32,
            "25. ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡¥±‡¥ø ‡¥Æ‡¥æ‡µº‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç": 32,
            "26. ‡¥°‡¥ø‡¥µ‡¥ø‡¥°‡µª‡¥°‡µç (Dividend)": 33,
            "27. ‡¥¨‡µã‡¥£‡¥∏‡µç ‡¥∑‡µÜ‡¥Ø‡µº": 33,
            "28. ‡¥°‡¥ø‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µç ‡¥Ö‡¥ï‡µç‡¥ï‡µó‡¥£‡µç‡¥ü‡µç": 34,
            "29. ‡¥ü‡µç‡¥∞‡µá‡¥°‡¥ø‡¥Ç‡¥ó‡µÅ‡¥Ç ‡¥á‡µª‡¥µ‡µÜ‡¥∏‡µç‡¥±‡µç‡¥±‡¥ø‡¥Ç‡¥ó‡µÅ‡¥Ç": 35,
            "30. ‡¥á‡µª‡¥ü‡µç‡¥∞‡¥æ‡¥°‡µá ‡¥ü‡µç‡¥∞‡µá‡¥°‡¥ø‡¥Ç‡¥ó‡µç": 36,
            "31. ‡¥°‡µÜ‡¥≤‡¥ø‡¥µ‡¥±‡¥ø ‡¥ü‡µç‡¥∞‡µá‡¥°‡¥ø‡¥Ç‡¥ó‡µç": 36,
            "32. ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç IPO?": 37,
            "33. ‡¥Ö‡¥™‡µç‡¥≤‡µà ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥® ‡¥∞‡µÄ‡¥§‡¥ø": 39,
            "34. ‡¥´‡¥£‡µç‡¥ü‡¥Æ‡µÜ‡¥®‡µç‡¥±‡µΩ ‡¥Ö‡¥®‡¥æ‡¥≤‡¥ø‡¥∏‡¥ø‡¥∏‡µç": 40,
            "35. ‡¥¨‡¥æ‡¥≤‡µª‡¥∏‡µç ‡¥∑‡µÄ‡¥±‡µç‡¥±‡µç": 41,
            "36. Asset Turnover Ratio": 41,
            "37. Current Ratio": 41,
            "38. ‡¥≤‡¥æ‡¥≠‡¥®‡¥∑‡µç‡¥ü ‡¥ï‡¥£‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡µæ (P&L)": 42,
            "39. Debt to Equity Ratio": 42,
            "40. ROE (Return on Equity)": 43,
            "41. ROCE": 43,
            "42. ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç ‡¥Æ‡µç‡¥Ø‡µÇ‡¥ö‡µç‡¥ö‡µΩ‡¥´‡¥£‡µç‡¥ü‡µç?": 44,
            "43. ‡¥Æ‡µç‡¥Ø‡µÇ‡¥ö‡µç‡¥ö‡µΩ‡¥´‡¥£‡µç‡¥ü‡µç ‡¥§‡¥∞‡¥ô‡µç‡¥ô‡µæ": 45,
            "44. ‡¥á‡¥ï‡µç‡¥µ‡¥ø‡¥±‡µç‡¥±‡¥ø ‡¥´‡¥£‡µç‡¥ü‡µÅ‡¥ï‡µæ": 45,
            "45. ‡¥°‡µÜ‡¥¨‡µç‡¥±‡µç‡¥±‡µç ‡¥´‡¥£‡µç‡¥ü‡µÅ‡¥ï‡µæ": 46,
            "46. ‡¥°‡¥Ø‡¥±‡¥ï‡µç‡¥ü‡µç vs ‡¥±‡µÜ‡¥ó‡µÅ‡¥≤‡µº ‡¥´‡¥£‡µç‡¥ü‡µç": 47,
            "47. ‡¥Æ‡µç‡¥Ø‡µÇ‡¥ö‡µç‡¥ö‡µΩ‡¥´‡¥£‡µç‡¥ü‡µç ‡¥Ö‡¥®‡¥æ‡¥≤‡¥ø‡¥∏‡¥ø‡¥∏‡µç": 48,
            "48. ‡¥é‡¥ï‡µç‡¥∏‡µç‡¥™‡µÜ‡µª‡¥∏‡µç ‡¥±‡µá‡¥∑‡µç‡¥Ø‡µã": 49,
            "49. Sharpe Ratio": 49,
            "50. Standard Deviation": 49,
            "51. ‡¥é‡¥ï‡µç‡¥∏‡¥ø‡¥±‡µç‡¥±‡µç ‡¥≤‡µã‡¥°‡µç": 50,
            "52. ‡¥¨‡µÄ‡¥±‡µç‡¥± (Beta)": 50,
            "53. ‡¥®‡¥∑‡µç‡¥ü‡¥ï‡µç‡¥ï‡¥£‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡µæ ‡¥§‡¥ø‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡¥±‡¥ø‡¥Ø‡¥æ‡¥Ç": 51,
            "54. ‡¥ï‡¥ü‡¥ï‡µç‡¥ï‡µÜ‡¥£‡¥ø‡¥ï‡µæ": 52,
            "55. ‡¥ï‡µç‡¥∞‡µÜ‡¥°‡¥ø‡¥±‡µç‡¥±‡µç ‡¥ï‡¥æ‡µº‡¥°‡µç ‡¥ö‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥¥‡¥ø‡¥ï‡µæ": 54,
            "56. ‡¥ì‡¥π‡¥∞‡¥ø ‡¥µ‡¥ø‡¥™‡¥£‡¥ø‡¥Ø‡¥ø‡¥≤‡µÜ ‡¥ö‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥¥‡¥ø‡¥ï‡µæ": 55,
            "57. ‡¥á‡µª‡¥∏‡µà‡¥°‡µº ‡¥ü‡µç‡¥∞‡µá‡¥°‡¥ø‡¥Ç‡¥ó‡µç": 57,
            "58. ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥§‡µç‡¥§‡¥ø‡¥ï ‡¥Ö‡¥ö‡µç‡¥ö‡¥ü‡¥ï‡µç‡¥ï‡¥Ç": 59,
            "59. ‡¥é‡¥Æ‡µº‡¥ú‡µª‡¥∏‡¥ø ‡¥´‡¥£‡µç‡¥ü‡µç": 60,
            "60. ‡¥Ü‡¥∞‡µã‡¥ó‡µç‡¥Ø ‡¥á‡µª‡¥∑‡µÅ‡¥±‡µª‡¥∏‡µç": 62,
            "61. ‡¥ü‡µá‡¥Ç ‡¥á‡µª‡¥∑‡µÅ‡¥±‡µª‡¥∏‡µç": 63,
            "62. ‡¥â‡¥™‡¥∏‡¥Ç‡¥π‡¥æ‡¥∞‡¥Ç": 65,
            "63. Bibliography": 67
        }

        selected = st.sidebar.selectbox("‡¥µ‡¥ø‡¥∑‡¥Ø‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï:", list(chapters.keys()))
        target_page = chapters[selected]

        st.sidebar.markdown("---")
        page_num = st.sidebar.number_input("‡¥™‡µá‡¥ú‡µç ‡¥®‡¥Æ‡µç‡¥™‡µº:", min_value=1, max_value=total_pages, value=target_page)

        st.title("üìà Stock Market & Mutual Fund")
        st.subheader(f"‡¥µ‡¥ø‡¥≠‡¥æ‡¥ó‡¥Ç: {selected}")

        # PDF Rendering - High Quality
        page = doc.load_page(page_num - 1)
        # ‡¥µ‡µç‡¥Ø‡¥ï‡µç‡¥§‡¥§‡¥Ø‡µç‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø 2.5x ‡¥∏‡µÇ‡¥Ç
        pix = page.get_pixmap(matrix=fitz.Matrix(2.5, 2.5))
        img = Image.open(io.BytesIO(pix.tobytes("png")))

        st.image(img, use_container_width=True)
        st.markdown(f"<p style='text-align: center;'>‡¥™‡µá‡¥ú‡µç {page_num} / {total_pages}</p>", unsafe_allow_html=True)

    except Exception as e:
        st.error(f"‡¥´‡¥Ø‡µΩ ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥ø‡¥≤‡µç‡¥≤! '{pdf_path}' ‡¥é‡¥®‡µç‡¥® ‡¥™‡µá‡¥∞‡¥ø‡µΩ ‡¥§‡¥®‡µç‡¥®‡µÜ ‡¥´‡¥Ø‡µΩ ‡¥â‡¥£‡µç‡¥ü‡µÜ‡¥®‡µç‡¥®‡µç ‡¥â‡¥±‡¥™‡µç‡¥™‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï.")

if __name__ == "__main__":
    main()
